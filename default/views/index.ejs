<!DOCTYPE html>
<html lang="<%- page.language %>">

<head>
    <%- include('includes/head.ejs'); -%>
</head>

<body>

<% /* Реклама вверху страницы */ %>
<% if (typeof page.adv === 'object' && page.adv.top) { %>
    <div style="text-align:center;margin:10px auto">
        <%- page.adv.top %>
    </div>
<% } %>

<% /* H1 тег */ %>
<h1><%- page.h1 %></h1>

<% /* Описание сайта */ %>
<% if (page.seo) { %>
    <div style="text-align:center;margin:10px auto">
        <%- page.seo %>
    </div>
<% } %>

<% /* Цикл блоков фильмов на главной странице */ %>
<% if (typeof index === 'object') { %>
    <% for (var type in index) { %>
        <% if (index.hasOwnProperty(type) && index[type].length && type !== 'episode') { %>
            <% index[type].forEach(function (category) { %>

                <% /* Справа от названия ссылка на случайный фильм из блока */ %>
                <div class="randomMovieIndex">
                    <div class="cinemapress-random-index"
                         onclick="window.location.href='<%- category.url %>?random'"
                         title="<%- page.l.random %>">
                        <img src="/themes/default/public/mobile/dice.svg" alt="<%- page.l.random %>">
                    </div>
                </div>

                <% /* Название блока */ %>
                <h2><%- category.name %></h2>

                <% /* Цикл фильмов в блоке */ %>
                <% if (category.movies.length) { %>
                    <% category.movies.forEach(function (movie) { %>

                        <%- include('includes/single.ejs', {movie: movie}); -%>

                    <% }); %>
                <% } %>

            <% }); %>
        <% } %>
    <% } %>
<% } %>

<% /* Блок серий на главной странице */ %>
<% if (typeof index === 'object') { %>
    <% for (var type in index) { %>
        <% if (index.hasOwnProperty(type) && index[type].length && type === 'episode') { %>
            <% index[type].forEach(function (category) { %>

                <% /* Название блока */ %>
                <h2><%- category.name %></h2>

                <% /* Цикл серий в блоке */ %>
                <% var moreEpisodes = false; %>
                <% if (category.movies.length) { %>
                    <ul>
                        <% category.movies.forEach(function (movie) { %>
                            <% /* Выводим ограниченное число серий, остальные скрываем */ %>
                            <li <% if (movie.hide) { moreEpisodes = true; %>style="display:none" data-more-episodes
                                    <% } %>
                            >
                                <% if (movie.season && movie.episode) { %>
                                    <% /* Сезон */ %>
                                    <%- movie.season %> <%- page.l.season %>
                                    <% /* Эпизод */ %>
                                    <%- movie.episode %> <%- page.l.episode %>
                                    <% if (movie.translate) { %>
                                        <% /* Озвучка */ %>
                                        <%- movie.translate %>
                                    <% } %>
                                <% } %>
                            </li>
                        <% }); %>
                    </ul>
                <% } %>

                <% /* Выводим кнопку для показа большего числа серий */ %>
                <% if (moreEpisodes) { %>
                    <div class="moreEpisodes"
                         onclick="var dme = document.querySelectorAll('[data-more-episodes]'); dme && dme.forEach(function(e) {e.style.display='block'});this.style.display='none'"><%- page.l.moreEpisodes %></div>
                <% } %>

            <% }); %>
        <% } %>
    <% } %>
<% } %>

<% /* Пагинация на главной странице */ %>
<% if (typeof page.pagination === 'object') { %>

    <% /* Первая страница */ %>
    <% if (page.pagination.first) { %>
        <a href="<%- page.pagination.first.link %>"><%- page.pagination.first.number %></a>
    <% } %>

    <% /* Номера страниц до текущей */ %>
    <% if (page.pagination.prev.length) { %>
        <% page.pagination.prev.forEach(function (prev) { %>
            <a href="<%- prev.link %>"><%- prev.number %></a>
        <% }); %>
    <% } %>

    <% /* Текуща страница */ %>
    <%- page.pagination.current %>

    <% /* Номера страниц после текущей */ %>
    <% if (page.pagination.next.length) { %>
        <% page.pagination.next.forEach(function (next) { %>
            <a href="<%- next.link %>"><%- next.number %></a>
        <% }); %>
    <% } %>

    <% /* Последняя страница */ %>
    <% if (page.pagination.last) { %>
        <a href="<%- page.pagination.last.link %>"><%- page.pagination.last.number %></a>
    <% } %>

<% } %>

<% /* Реклама внизу страницы */ %>
<% if (typeof page.adv === 'object' && page.adv.bottom) { %>
    <div style="text-align:center;margin:10px auto">
        <%- page.adv.bottom %>
    </div>
<% } %>

<%- include('includes/footer.ejs'); -%>

</body>

</html>